<!DOCTYPE html>
<title>ECMAScript 5 parser</title>

<style>
body,html {margin:0;padding:0}
fieldset {width:100%;border:0;padding:0;margin:0;background:#888;position:relative}
label {display:inline-block;border:2px solid black;width:90%;margin:1em 2%;position:relative;background:#AAA}
textarea {width:100%;height:24em;border:0}
</style>

<script src=../ES5_v5_1.js></script>
<script src=PEG_util.js></script>

<!-- for displaying the raw parse tree with JSON.stringify -->
<script src=../../compat/json2.js></script>

<h1>ECMAScript 5 Parser 2009-12-14</h1>

<p>Updated 2009-12-31 (nicer showTree output, added raw parse tree, added links)</p>

<p>See the <a href=http://inimino.org/~inimino/blog/peg_first_release>related blog post</a>.
You may also want to look at the <a href=../ECMAScript_unified.peg>PEG input</a> from which the parser is generated.</p>

<p id=status></p>

<fieldset>
<label>Input: <textarea id=text readonly></textarea></label>
<label>Parse Tree pretty-printed by showTree(): <textarea id=parse_tree readonly></textarea></label>
<label>Parse Tree (raw) (see <a href=../doc/parse_tree_representation>documentation</a>): <textarea id=parse_tree_raw readonly></textarea></label>
</fieldset>

<script>

var inputText_el=document.getElementById('text')
  , parseTree_el=document.getElementById('parse_tree')
  , parseTreeRaw_el=document.getElementById('parse_tree_raw')
  , status_el=document.getElementById('status')

function status(s){var ms,now
 now=+new Date
 ms=status.prev ? ' '+(now-status.prev)+'ms' : ''
 status.prev=now
 status_el.innerHTML+=ms+'<br>'+s}

function xhr(method,uri,body,callback){var headers,p
  if(typeof method==='object'){headers=method.headers;method=method.method}
  var x=new XMLHttpRequest()
  x.onreadystatechange=function(){if (x.readyState==4){callback(x)}}
  x.open(method,uri,true)
  if(headers) for(p in headers){x.setRequestHeader(p,headers[p])}
  x.send(body)}

status('fetching input...')
//xhr('GET','../ES5_v5_1.js',null,function(x){
xhr('GET','Y.js',null,function(x){
 inputText_el.value=x.responseText
 //inputText_el.value="function f(){return 42}"
 parseAndShow(inputText_el.value)
 status('done')})

function parseAndShow(s){var pt
  status('parsing...')
  pt=p_ES5_v5_Program(s)
  //return s+'\n\n'+uneval(pt) // TODO: display parse errors
  if(pt[0]){
    status('pretty-printing parse tree...')
    parseTree_el.value=showTree(pt[1],p_ES5_v5_Program.names,s)
    status('displaying raw parse tree...')
    parseTreeRaw_el.value=JSON.stringify(pt[1])}
  else{
    parseTree_el.value='parse error'}}

//function updateParseTree(){
//  parseTree_el.value=parseAndShow(inputText_el.value)}

//function delay(f,ms){return function(){
//  if(f.pending) clearTimeout(f.pending)
//  f.pending = setTimeout(f,ms)}}

//inputText_el.onkeydown=inputText_el.onkeyup=inputText_el.onclick=delay(updateParseTree,50)
//inputText_el.focus()

</script>